# 1Ô∏è‚É£ Build the frontend using Node.js
FROM node:20 AS builder

# 2Ô∏è‚É£ Set working directory
WORKDIR /app

# 3Ô∏è‚É£ Copy package files first (to optimize caching)
COPY package.json package-lock.json ./

# 4Ô∏è‚É£ **Force npm to install ALL dependencies**
RUN npm ci

# 5Ô∏è‚É£ Copy all frontend source code
COPY . .

# 6Ô∏è‚É£ ‚úÖ Ensure the frontend actually builds
RUN npm run build && ls -l /app/dist

# 7Ô∏è‚É£ Use NGINX to serve the built frontend
FROM nginx:alpine

# 8Ô∏è‚É£ Copy the built frontend files
COPY --from=builder /app/dist /usr/share/nginx/html

# 9Ô∏è‚É£ Expose port 80
EXPOSE 80

# üîü Start NGINX
CMD ["nginx", "-g", "daemon off;"]
